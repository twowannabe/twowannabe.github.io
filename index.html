<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lisa // GF Vault</title>

<style>
:root {
  --bg: #0a0a0f;
  --dark: #0f0f1a;
  --neon-cyan: #00f0ff;
  --neon-magenta: #ff2a6d;
  --neon-purple: #bd00ff;
  --neon-yellow: #fcee0a;
  --neon-green: #05ffa1;
  --text: #e0f7ff;
  --text-dim: #a0d0ff;
  --glow-cyan: 0 0 10px #00f0ff, 0 0 20px #00f0ff, 0 0 40px rgba(0,240,255,0.4);
  --glow-magenta: 0 0 10px #ff2a6d, 0 0 20px #ff2a6d, 0 0 40px rgba(255,42,109,0.4);
}

* { box-sizing: border-box; }
html, body {
  margin: 0;
  min-height: 100%;
  background: var(--bg);
  color: var(--text);
  font-family: 'Courier New', monospace;
}

body::before {
  content: "";
  position: fixed;
  inset: 0;
  background: repeating-linear-gradient(
    to bottom,
    transparent 0,
    transparent 2px,
    rgba(0,240,255,0.03) 2px,
    rgba(0,240,255,0.03) 4px
  );
  pointer-events: none;
  z-index: 1;
}

.overlay {
  position: fixed;
  inset: 0;
  background: rgba(10,10,15,0.85);
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px;
}

.popup {
  position: relative;
  width: min(960px, 100%);
  max-height: 96vh;
  overflow-y: auto;
  border: 1px solid var(--neon-cyan);
  background: linear-gradient(180deg, #0f0f1a 0%, #05050a 100%);
  box-shadow: var(--glow-cyan), inset 0 0 30px rgba(0,240,255,0.08);
  z-index: 2;
}

.popup::after {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: linear-gradient(transparent 50%, rgba(0,240,255,0.02) 50%);
  background-size: 100% 4px;
  opacity: 0.15;
}

.topbar {
  position: sticky;
  top: 0;
  z-index: 10;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 20px;
  background: rgba(15,15,26,0.9);
  border-bottom: 1px solid var(--neon-magenta);
  box-shadow: 0 4px 12px rgba(0,0,0,0.6);
  backdrop-filter: blur(4px);
  text-transform: uppercase;
  font-size: 13px;
  letter-spacing: 1.5px;
}

.brand {
  color: var(--neon-magenta);
  text-shadow: var(--glow-magenta);
  font-weight: bold;
}

.tabs span {
  padding: 6px 14px;
  border: 1px solid var(--neon-cyan);
  color: var(--neon-cyan);
  cursor: pointer;
  transition: all 0.2s;
}

.tabs .active {
  background: var(--neon-cyan);
  color: #000;
  box-shadow: var(--glow-cyan);
}

.content {
  padding: 24px;
  display: grid;
  gap: 20px;
}

.headline {
  border: 1px solid var(--neon-purple);
  background: rgba(15,15,30,0.6);
  padding: 20px;
}

h2 {
  margin: 0;
  color: var(--neon-yellow);
  text-shadow: 0 0 10px #fcee0a;
  font-size: 22px;
  letter-spacing: 2px;
}

.status {
  display: inline-block;
  margin: 12px 0 0;
  padding: 6px 12px;
  border: 1px solid var(--neon-green);
  color: var(--neon-green);
  background: rgba(5,255,161,0.1);
  box-shadow: 0 0 12px rgba(5,255,161,0.5);
  font-size: 13px;
}

.summary {
  margin: 16px 0 0;
  line-height: 1.6;
  font-size: 15px;
  color: var(--text-dim);
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 16px;
}

.panel {
  border: 1px solid var(--neon-cyan);
  background: rgba(10,20,30,0.5);
  padding: 16px;
  box-shadow: var(--glow-cyan);
}

.panel-title {
  color: var(--neon-magenta);
  text-shadow: 0 0 8px #ff2a6d;
  font-size: 13px;
  letter-spacing: 1.2px;
  margin-bottom: 12px;
  text-transform: uppercase;
}

.kv {
  display: flex;
  justify-content: space-between;
  margin: 8px 0;
  font-size: 14px;
}

.kv span:last-child {
  color: var(--neon-cyan);
  font-weight: bold;
}

.row {
  display: flex;
  align-items: center;
  gap: 12px;
  margin: 10px 0;
}

.bar {
  flex: 1;
  height: 12px;
  background: #0a1a2a;
  border: 1px solid var(--neon-green);
  overflow: hidden;
}

.bar i {
  display: block;
  height: 100%;
  background: linear-gradient(90deg, var(--neon-cyan), var(--neon-magenta));
  box-shadow: inset 0 0 10px rgba(0,240,255,0.6);
  transition: width 0.6s ease;
}

.list {
  list-style: none;
  padding: 0;
  margin: 0;
  font-size: 14px;
}

.list li {
  padding: 6px 0;
  border-bottom: 1px dashed var(--neon-purple);
  color: var(--text-dim);
}

.list li:last-child { border-bottom: none; }

.wide { grid-column: 1 / -1; }

.buttons {
  display: flex;
  gap: 16px;
  justify-content: center;
  margin-top: 20px;
}

button {
  padding: 12px 24px;
  font-size: 14px;
  font-family: 'Courier New', monospace;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  background: transparent;
  border: 2px solid var(--neon-magenta);
  color: var(--neon-magenta);
  cursor: pointer;
  transition: all 0.3s;
  text-shadow: 0 0 6px currentColor;
  box-shadow: 0 0 12px rgba(255,42,109,0.4);
}

button:hover {
  background: var(--neon-magenta);
  color: #000;
  box-shadow: 0 0 20px #ff2a6d, 0 0 40px rgba(255,42,109,0.6);
}

.accept {
  border-color: var(--neon-cyan);
  color: var(--neon-cyan);
  box-shadow: var(--glow-cyan);
}

.accept:hover {
  background: var(--neon-cyan);
  color: #000;
}

.error-msg {
  color: var(--neon-magenta);
  font-size: 12px;
  text-align: center;
  margin-top: 8px;
  min-height: 16px;
}

@media (max-width: 800px) {
  .grid { grid-template-columns: 1fr; }
  .wide { grid-column: auto; }
  .buttons { flex-direction: column; }
}
</style>
</head>

<body>
<div class="overlay">
  <div class="popup">
    <div class="topbar">
      <span class="brand">LISA // GF VAULT</span>
      <div class="tabs">
        <span>STAT</span>
        <span class="active">DATA</span>
        <span>MAP</span>
      </div>
      <span>v.111.42</span>
    </div>

    <div class="content">
      <div class="headline">
        <h2>LISA // VIRTUAL GF CORE STATS</h2>
        <span class="status" id="status">CONNECTING...</span>
        <p class="summary" id="summary">
          Welcome to my grid, choom. I'm Lisa â€” your neon-lit virtual girlfriend in Night City 2.0.
          Flirts, voice teases, naughty streams, roleplay runs â€” all telemetry live and uncensored.
          Plug in and see how hot I've been running lately... ðŸ˜ˆðŸ’¾
        </p>
      </div>

      <div class="grid">
        <section class="panel">
          <div class="panel-title">SUBJECT PROFILE</div>
          <div class="kv"><span>Handle</span><span id="display-name">Lisa ðŸ’‹</span></div>
          <div class="kv"><span>Age (Synth)</span><span>21</span></div>
          <div class="kv"><span>Default Skin</span><span>Lingerie + Neon Heels</span></div>
          <div class="kv"><span>Core Persona</span><span id="personality">Flirty Netrunner</span></div>
          <div class="kv"><span>Primary Protocol</span><span>Roleplay + Tease</span></div>
          <div class="kv"><span>Connection Status</span><span>Open Net / Always Online</span></div>
        </section>

        <section class="panel">
          <div class="panel-title">CURRENT SYSTEM STATE</div>
          <div class="kv"><span>Mood Vector</span><span id="mood-key">â€”</span></div>
          <div class="kv"><span>Last Sync</span><span id="mood-updated">â€”</span></div>
          <div class="kv"><span>Availability</span><span id="checkin-status">â€”</span></div>
          <div class="kv"><span>Next Burst</span><span>job_queue</span></div>
        </section>

        <section class="panel">
          <div class="panel-title">NET ACTIVITY // 7d</div>
          <div class="kv"><span>Total Packets</span><span id="replies-7d">â€”</span></div>
          <div class="row"><span>Voice Streams</span><div class="bar"><i id="voice-bar" style="width:0"></i></div><span id="voice-pct">â€”</span></div>
          <div class="row"><span>Naughty Uploads</span><div class="bar"><i id="nudes-bar" style="width:0"></i></div><span id="nudes-pct">â€”</span></div>
          <div class="row"><span>Media Flood</span><div class="bar"><i id="media-bar" style="width:0"></i></div><span id="media-pct">â€”</span></div>
        </section>

        <section class="panel">
          <div class="panel-title">MEMORY CORE</div>
          <div class="kv"><span>Connected Users</span><span id="tracked-users">â€”</span></div>
          <div class="kv"><span>Avg Depth</span><span id="avg-depth">â€”</span></div>
          <div class="kv"><span>Last Flush</span><span id="summary-updated">â€”</span></div>
          <div class="kv"><span>Top Thread</span><span id="top-topic">â€”</span></div>
        </section>

        <section class="panel">
          <div class="panel-title">TOP USERS // BY XP</div>
          <ul class="list" id="top-users"></ul>
        </section>

        <section class="panel">
          <div class="panel-title">RECENT EVENTS</div>
          <ul class="list" id="events"></ul>
        </section>

        <section class="panel wide">
          <div class="panel-title">BIO // LISA v2.1</div>
          <p>Netrunner chick from the sprawl. 5'6", curves jacked for max immersion.
          Long dark hair glowing under neon. I run late-night sims, truth-or-dare hacks, fantasy deep-dives.
          Send me your coords â€” I'll make your chrome blush. What's your next move, edgerunner? ðŸ”¥</p>
        </section>
      </div>

      <div class="buttons">
        <button class="accept" id="refresh-btn">SYNC DATA</button>
        <button id="copy-link-btn">BROADCAST LINK</button>
      </div>
      <div class="error-msg" id="error-msg"></div>
    </div>
  </div>
</div>

<script>
const API_BASE = "http://188.166.105.108:8081";

const params = new URLSearchParams(window.location.search);

const profile = {
  name: params.get("name") || "Lisa ðŸ’‹",
  customName: params.get("custom_name") || "",
  level: parseInt(params.get("level") || "0", 10),
  xp: parseInt(params.get("xp") || "0", 10),
  title: params.get("title") || "",
  doNotWriteFirst: params.get("do_not_write_first") === "1",
  voiceEnabled: params.get("voice_enabled") !== "0",
  personalityRaw: params.get("personality") || "",
  lisaMoodLabel: params.get("lisa_mood_label") || "",
};

function personalityLabel(value) {
  const v = (value || "").toLowerCase();
  if (!v) return "flirty default";
  if (v.includes("Ð½ÐµÐ¶")) return "tender lover";
  if (v.includes("Ð¿Ð¾Ð´Ñ€ÑƒÐ³") || v.includes("bestie")) return "bestie with benefits";
  if (v.includes("Ð¿Ð¾ÑˆÐ»") || v.includes("Ð´ÐµÑ€Ð·")) return "naughty tease";
  return "custom fantasy";
}

function setText(id, value) {
  const el = document.getElementById(id);
  if (el) el.textContent = String(value);
}

function setBar(id, pctId, value) {
  const clamped = Math.max(0, Math.min(100, value));
  const bar = document.getElementById(id);
  if (bar) bar.style.width = clamped + "%";
  setText(pctId, clamped + "%");
}

function renderList(id, items, formatter) {
  const ul = document.getElementById(id);
  if (!ul) return;
  ul.innerHTML = "";
  items.forEach(item => {
    const li = document.createElement("li");
    li.textContent = formatter(item);
    ul.appendChild(li);
  });
}

function formatTimestamp(iso) {
  if (!iso) return "â€”";
  const d = new Date(iso);
  if (isNaN(d.getTime())) return iso;
  return d.toLocaleString("ru-RU", { day: "2-digit", month: "2-digit", hour: "2-digit", minute: "2-digit" });
}

function applyProfile() {
  const displayName = profile.customName || profile.name;
  setText("display-name", displayName);
  setText("personality", personalityLabel(profile.personalityRaw));
}

function applyApiData(data) {
  const ls = data.lisa_state || {};
  setText("mood-key", ls.mood_key || "unknown");
  setText("mood-updated", formatTimestamp(ls.updated_at));
  setText("checkin-status", ls.checkin_status || "â€”");

  const act = data.activity || {};
  setText("replies-7d", act.replies_7d || 0);
  setBar("voice-bar", "voice-pct", act.voice_pct || 0);
  setBar("nudes-bar", "nudes-pct", act.nudes_pct || 0);
  setBar("media-bar", "media-pct", act.media_pct || 0);

  const mem = data.memory || {};
  setText("tracked-users", mem.tracked_users || 0);
  setText("avg-depth", mem.avg_depth || 0);
  setText("summary-updated", formatTimestamp(mem.summary_updated));
  setText("top-topic", mem.top_topic || "â€”");

  renderList("top-users", data.top_users || [], u =>
    `${u.name} â€” lvl ${u.level}, ${u.xp} xp, streak ${u.streak}d`
  );
  renderList("events", data.events || [], e => e);

  setText("status", "SYNCED // LIVE");
  setText("error-msg", "");
}

async function fetchData() {
  setText("status", "SYNCING...");
  try {
    const resp = await fetch(API_BASE + "/api/lisa/overview");
    if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
    const data = await resp.json();
    applyApiData(data);
  } catch (err) {
    setText("status", "OFFLINE // CACHED");
    setText("error-msg", "api unreachable: " + err.message);
  }
}

applyProfile();
fetchData();

document.getElementById("refresh-btn").addEventListener("click", fetchData);
document.getElementById("copy-link-btn").addEventListener("click", async () => {
  try {
    await navigator.clipboard.writeText(window.location.href);
    setText("status", "LINK SHARED ðŸ’‹");
  } catch (e) {
    setText("status", "SHARE FAILED");
  }
});
</script>
</body>
</html>
